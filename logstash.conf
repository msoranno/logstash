input {
  beats {
      port => "5043"
  }
}

filter {
   if [type] == "fst" {
     grok {
       #Si el grok hace match en el mensaje le mete valid en el campo tags
       add_tag => [ "valid" ]
        match => { "message" => "%{DATE:fecha:datestamp}, %{GREEDYDATA:hora} - %{DATA:miembro}:" }
     }
     #si no es valido se descarta
     if "valid" not in [tags] {
       drop { }
     }
   }
   if [type] == "familia" {
     grok {
       #Si el grok hace match en el mensaje le mete valid en el campo tags
       add_tag => [ "valid" ]
        match => { "message" => "%{DATE:fecha:datestamp}, %{GREEDYDATA:hora} - %{DATA:miembro}:" }
     }
     #si no es valido se descarta
     if "valid" not in [tags] {
       drop { }
     }
   }


}
 

output {
  #Esto provoca una salida por la terminal
  stdout {
   codec => rubydebug
  }
  #Esto manda a elastic search
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    user => elastic
    password => changeme
    index => "%{type}_index"
  }

}
